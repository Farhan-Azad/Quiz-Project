<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz</title>
  <link rel="stylesheet" href="style.css">

  <style>
    .question {
      margin-bottom: 20px;
    }
    #timer {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Quiz</h1>
  <div id="timer">Time Remaining: 60 seconds</div>
  <div id="quiz-container">
    Loading quiz...
  </div>
  <button id="submit-btn" style="display:none;">Submit Quiz</button>

  <script>
    let quizData = [];
    let userAnswers = [];
    let timeRemaining = 60; // seconds
    let timerInterval;

    // Function to start the timer
    function startTimer() {
      timerInterval = setInterval(() => {
        timeRemaining--;
        document.getElementById('timer').innerText = `Time Remaining: ${timeRemaining} seconds`;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          autoSubmitQuiz();
        }
      }, 1000);
    }

    // Function to automatically submit the quiz when time expires
    function autoSubmitQuiz() {
      // Gather user's answers
      userAnswers = quizData.map((q, index) => {
        const selected = document.querySelector(`input[name="question-${index}"]:checked`);
        return selected ? selected.value : null;
      });
      // Send answers to server for evaluation
      fetch('/api/submit-quiz', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          answers: userAnswers,
          questions: quizData
        })
      })
      .then(response => response.json())
      .then(data => {
        // Redirect to results page with score as URL parameter
        window.location.href = `/results.html?score=${data.score}`;
      });
    }

    // Fetch quiz questions from the server and start the timer
    fetch('/api/start-quiz')
      .then(response => response.json())
      .then(data => {
        quizData = data.questions;
        displayQuiz();
        startTimer();
      });

    function displayQuiz() {
      const container = document.getElementById('quiz-container');
      container.innerHTML = '';
      quizData.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question';
        questionDiv.innerHTML = `<p>${index + 1}. ${q.question}</p>`;
        // Display options A-D
        ['A', 'B', 'C', 'D'].forEach(letter => {
          const label = document.createElement('label');
          label.innerHTML = `<input type="radio" name="question-${index}" value="${letter}"> ${letter}. ${q[letter]}<br>`;
          questionDiv.appendChild(label);
        });
        container.appendChild(questionDiv);
      });
      document.getElementById('submit-btn').style.display = 'block';
    }

    document.getElementById('submit-btn').addEventListener('click', () => {
      clearInterval(timerInterval);
      autoSubmitQuiz();
    });
  </script>
</body>
</html>

